add_definitions(-DCOMPILE_FOR_UNIT_TESTS)

macro(vc_add_test name)
   set(simpleTarget "${name}_simple")
   set(sseTarget "${name}_sse")
   set(lrbTarget "${name}_lrb")

   add_executable(${simpleTarget} ${name}.cpp)
   target_link_libraries(${simpleTarget} Vc)
   add_target_property(${simpleTarget} COMPILE_FLAGS "-DVC_IMPL=Scalar")
   add_test(${simpleTarget} "${CMAKE_CURRENT_BINARY_DIR}/${simpleTarget}")

   add_executable(${sseTarget} ${name}.cpp)
   target_link_libraries(${sseTarget} Vc)
   add_test(${sseTarget} "${CMAKE_CURRENT_BINARY_DIR}/${sseTarget}")

   if(LARRABEE_FOUND)
      add_executable(${lrbTarget} ${name}.cpp)
      target_link_libraries(${lrbTarget} Vc)
      add_target_property(${lrbTarget} COMPILE_FLAGS "-DVC_IMPL=LRBni")
      add_test(${lrbTarget} "${CMAKE_CURRENT_BINARY_DIR}/${lrbTarget}")
   endif(LARRABEE_FOUND)
endmacro(vc_add_test)

vc_add_test(memory)
vc_add_test(arithmetics)
vc_add_test(expandandmerge)
vc_add_test(load)
vc_add_test(store)
vc_add_test(gather)
vc_add_test(scatter)
vc_add_test(math)
vc_add_test(mask)
vc_add_test(utils)

if(GCC_4_4_1)
  add_executable(sse_blend sse_blend.cpp)
  add_test(sse_blend "${CMAKE_CURRENT_BINARY_DIR}/sse_blend")
  target_link_libraries(sse_blend Vc)
endif(GCC_4_4_1)

set(target "gather_sse_LOOP")
add_executable(${target} gather.cpp)
add_target_property(${target} COMPILE_FLAGS "-DVC_NO_GATHER_TRICKS")
target_link_libraries(${target} Vc)
add_test(${target} "${CMAKE_CURRENT_BINARY_DIR}/${target}")
